# 笔录转换网站

## 1. 项目简介
本项目旨在开发一个Web应用，能够将用户上传（或粘贴）的1v1访谈笔录高效、准确地转换为符合口述习惯的、被访者第一人称叙述式笔录。应用的核心目标是简化笔录整理工作，提高内容的可读性和流畅性。

## 2. 功能模块与核心设计 (MVP - 最小可行产品)
本项目 MVP 版本将采用单页面布局，所有核心功能均在同一页面呈现，无需页面跳转。整体界面固定，不产生页面级滚动，内容较多时在特定区域内部滚动。

### 2.1 页面布局与主要功能区 (MVP)

**MVP 页面结构总结**:
MVP版本采用单页面、三栏固定布局设计，核心区域如下：
*   **左上角**: 文件上传控件。
*   **左栏**: 原始笔录显示区 (内部滚动)。
*   **中栏**: 规则配置区 (包含被访者选择、规则开关、操作按钮)。
*   **右栏**: 转换后笔录显示区 (内部滚动)。
*   **右下角**: 下载转换后笔录按钮。

**主要功能区**:
1.  **上传文件功能区 (左上角，固定位置)**:
    *   提供文件选择按钮。
    *   仅支持用户上传 `.txt` 格式的文件。
    *   上传成功后，内容自动加载到下方的"原始笔录"区域。

2.  **原始笔录区 (左栏，固定宽度和高度，内容溢出时内部垂直滚动)**:
    *   显示上传的 `.txt` 文件中的原始内容。
    *   严格保持与原始文件中的换行一致进行展示。
    *   若文本内容超出显示区域高度，则启用内部垂直滚动条。

3.  **规则配置区 (中栏，固定宽度和高度，固定位置)**:
    *   区域始终可见，尺寸和位置固定。
    *   **转换规则选项 (默认关闭)**:
        *   "视角转换": 提供开关 (Switch/Toggle)，默认关闭。
        *   "基础语气词/口头禅处理": 提供开关 (Switch/Toggle)，默认关闭。
        *   (规则选项仅提供简单开/关，无细致配置，无示例)
    *   **"被访者"选择**:
        *   使用一组单选按钮 (Radio Buttons)。
        *   系统从"原始笔录"中识别并列出两位发言人标记（例如，若原文有 "A:", "B:"，则提供 "A" 和 "B" 两个单选选项，去除冒号）。
    *   **操作按钮**:
        *   `应用规则` 按钮: 点击后，根据当前"被访者"的选择及转换规则开关状态，处理原始笔录，结果刷新至右栏。
        *   `重置规则` 按钮: 点击后，所有转换规则选项开关还原到关闭状态，"被访者"选择也被清空。

4.  **转换后笔录区 (右栏，固定宽度和高度，内容溢出时内部垂直滚动)**:
    *   仅显示纯文本的转换结果。
    *   点击中栏 `应用规则` 按钮后，此区域内容刷新。
    *   若文本内容超出显示区域高度，则启用内部垂直滚动条。

5.  **下载转换后笔录功能区 (右下角，固定位置)**:
    *   按钮名称为 `下载转换后笔录`。
    *   点击后，下载右栏显示的纯净文本内容为 `.txt` 文件。

## 3. 技术栈 (Technology Stack)

*   **前端框架**:
    *   **React** (通过 **Next.js** 框架实现)
    *   **Styling**: **Tailwind CSS**

*   **后端语言/框架 (LLM 服务)**:
    *   **Language**: **Python**
    *   **Web Framework**: **FastAPI** (用于构建供前端调用的 API 服务，并承载 LLM 推理逻辑)

*   **核心文本处理/NLP**:
    *   **LLM Interaction**: **Hugging Face `transformers`** 库 (用于在 Python 后端加载和运行本地语言模型，或与云端 LLM API 交互)
    *   MVP 阶段主要依赖 LLM 进行视角转换和语气词/口头禅处理，通过精心设计的提示 (Prompt Engineering) 实现。
    *   发言人识别初步可以基于模式匹配，未来可由 LLM 辅助或完成。

*   **数据库**:
    *   **MVP 阶段**: **不使用数据库**。
    *   未来可能根据用户账户、历史记录等功能需求引入，届时再行选型 (如 PostgreSQL 或 MongoDB)。

*   **开发工具、代码质量与版本控制**:
    *   **版本控制**: **Git** (配合 **GitHub**进行代码托管和协作)。
    *   **前端包管理**: **npm** (或 **Yarn**，根据 Next.js 项目初始化选择)。
    *   **后端包管理 (Python)**: **Poetry** (用于依赖管理、虚拟环境和打包)。
    *   **前端代码质量**:
        *   **Linting**: **ESLint**
        *   **Formatting**: **Prettier**
    *   **后端代码质量 (Python)**:
        *   **Linting & Formatting**: **Ruff** (推荐，因其速度和全面性)
        *   (备选: `Black` for formatting, `Flake8` for linting, `Mypy` for type checking)

*   **部署方案**: 待讨论

## 4. 开发计划 (MVP版本)

### 阶段一：后端 API 服务搭建 (Python/FastAPI & LLM 集成)
成功搭建一个能够接收原始文本和配置参数、通过集成 LLM (Hugging Face `transformers`) 识别文本中的发言人，并对文本进行处理（视角转换、语气词处理）并返回处理结果的 FastAPI 后端服务。
*   **任务拆解**:
    *   **任务 1.1：项目初始化与基础 API 端点**
        *   使用 Poetry 初始化 FastAPI 后端项目。
        *   搭建基础项目结构。
        *   实现一个接收原始文本、被访者选择和规则配置（开关状态）的 API 端点 (POST请求)。
        *   实现一个返回处理后文本的 API 端点。
    *   **任务 1.2：发言人识别逻辑**
        *   实现从上传文本中识别发言人标记（例如 "A:", "B:"）并提取发言人名称的逻辑。此列表将用于前端动态生成"被访者"单选按钮。
    *   **任务 1.3：集成 Hugging Face `transformers`与 LLM**
        *   在 FastAPI 应用中集成 Hugging Face `transformers` 库。
        *   配置加载本地 LLM 模型的逻辑（或连接云端 LLM API 的客户端）。
        *   初步实现调用 LLM 进行文本处理的核心函数，包括：
            *   视角转换（根据选定的被访者）。
            *   基础语气词/口头禅处理。
            *   (此阶段重点是打通调用流程，Prompt Engineering 可持续优化)。
    *   **任务 1.4：API 逻辑完善与测试**
        *   将发言人识别、LLM 文本处理逻辑整合到 API 端点中。
        *   使用工具（如 FastAPI 自动生成的交互式文档、Postman 或 curl）对 API 端点进行初步测试。

### 阶段二：前端用户界面与基础交互 (Next.js/React & Tailwind CSS)
实现 MVP 设计的核心用户界面，包括三栏固定布局、文件上传、原始文本展示、规则配置区域（静态）、转换后文本展示区域（静态）以及下载按钮（静态）。确保界面元素位置固定，内容溢出时各栏内部可滚动。
*   **任务拆解**:
    *   **任务 2.1：项目初始化与基本布局**
        *   使用 `create-next-app` 初始化 Next.js 前端项目，并集成 Tailwind CSS。
        *   实现 MVP 设计稿中的单页面三栏固定布局（左、中、右），确保各区域尺寸固定，内容溢出时各栏内部可垂直滚动。
    *   **任务 2.2："上传文件"与"原始笔录"区域**
        *   实现左上角的"上传文件"功能：
            *   仅允许选择 `.txt` 文件。
            *   读取文件内容。
        *   实现左栏"原始笔录"区域：
            *   显示上传的 `.txt` 文件内容，保持原文换行。
    *   **任务 2.3："规则配置区"界面**
        *   实现中栏"规则配置区"的静态界面元素：
            *   "视角转换"开关。
            *   "基础语气词/口头禅处理"开关。
            *   "被访者"单选按钮区域的占位。
            *   "应用规则"按钮。
            *   "重置规则"按钮。
    *   **任务 2.4："转换后笔录"与"下载"区域界面**
        *   实现右栏"转换后笔录"区域的静态界面。
        *   实现右下角的"下载转换后笔录"按钮的静态界面。
    *   **组件实现策略**: 在实现上述UI元素时，应首先在 `21st-dev/magic` 组件库（如果其组件与 React/Next.js 兼容）或类似的基于 React/Tailwind CSS 的组件库（如 Shadcn UI 风格的组件）中查找可直接使用或适配的成熟组件。若无完全合适的组件，或现有组件对于 MVP 阶段过于复杂，则基于 Tailwind CSS 构建满足 MVP 需求的、功能简约的界面元素。

### 阶段三：前后端集成与核心功能实现
将前端界面与后端 API 服务完全打通，实现从用户上传文件、配置规则、应用规则、查看转换结果到下载结果的完整核心业务流程。
*   **任务拆解**:
    *   **任务 3.1：动态生成"被访者"选项**
        *   前端：当 `.txt` 文件上传并加载到"原始笔录"区后，将文本内容发送到后端（或调用后端的特定辅助接口），获取发言人列表。
        *   前端：根据后端返回的发言人列表，动态生成"被访者"单选按钮。
    *   **任务 3.2：实现"应用规则"功能**
        *   前端：点击"应用规则"按钮时，收集当前"原始笔录"内容、选择的"被访者"、以及各项转换规则的开关状态。
        *   前端：将收集到的数据发送到后端 FastAPI 的主处理 API 端点。
        *   后端：接收数据，调用 LLM 处理文本。
        *   前端：接收后端返回的转换后文本，并将其显示在右栏的"转换后笔录"区域。
    *   **任务 3.3：实现"重置规则"功能**
        *   前端：点击"重置规则"按钮后，将"视角转换"和"基础语气词/口头禅处理"的开关恢复到默认关闭状态，并清空"被访者"的单选按钮选择。
    *   **任务 3.4：实现"下载转换后笔录"功能**
        *   前端：点击"下载转换后笔录"按钮后，将右栏"转换后笔录"区域的文本内容以 `.txt` 文件的形式下载到用户本地。

### 阶段四：MVP 优化、测试与文档
对 MVP 版本进行初步的功能优化（尤其是 LLM Prompt），实现基本的错误处理，完成端到端的功能验证，并准备好项目的 README 和基础运行说明。
*   **任务拆解**:
    *   **任务 4.1：LLM Prompt Engineering 初步优化**
        *   根据初步的转换效果，迭代优化发送给 LLM 的提示（Prompt），以提高"视角转换"和"语气词处理"的准确性和自然度。
    *   **任务 4.2：基本错误处理**
        *   前端：处理文件上传失败、API 请求失败等基本错误情况，并给出用户提示。
        *   后端：处理无效输入、LLM 调用异常等基本错误，并返回合适的错误响应。
    *   **任务 4.3：端到端测试**
        *   完整测试从文件上传到下载转换后笔录的整个 MVP 流程，确保各功能模块协同工作正常。
    *   **任务 4.4：准备 README 和基础运行说明**
        *   完善 `README.md` 文件，包括项目简介、最终技术栈、详细的本地开发环境搭建和项目运行步骤。